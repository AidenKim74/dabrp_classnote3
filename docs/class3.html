<!DOCTYPE html>
<html>
  <head>
    <title>(3주차)데이터 분석을 위한 중급 R 프로그래밍 CAMP 3기</title>
    <meta charset="utf-8">
    <meta name="author" content="박찬엽" />
    <link href="libs/remark-css/example.css" rel="stylesheet" />
    <link rel="stylesheet" href="class.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">




class: center, middle, title-slide

## 데이터 분석의 기본이 되는 데이터전처리
#### Step1. 데이터 전처리를 위한 기초 학습하기
### &lt;https://mrchypark.github.io/dabrp_classnote3/class3&gt;

### 박찬엽

### 2017년 9월 21일
---

## 목차

0. 과제 질답

1. 수업의 목표

2. 데이터를 다루는 주요 7가지 동작
    - 데이터 소개 : nycflights13
    - dplyr을 활용한 주요 7가지 동작

3. tidy data, long form과 wide form
    - 함수를 연결하는 파이프 연산자
    - tidyr로 데이터를 tidy하게 만들기

4. 데이터 소스에 연결하기
    - 데이터 소스 소개와 연결 패키지 dbplyr, dtplyr
    - 데이터 소스와 함께 사용하는 dplyr 함수

5. 과제


---

class: center, middle, title-slide

## 과제 질답

---

## 수업의 목표

### 1. 데이터를 다루는 주요 7가지 동작을 설명할 수 있다.

### 2. tidy data, long form과 wide form의 장단점을 설명할 수 있다.

### 3. 데이터 베이스의 테이블을 R 객체에 연결하여 데이터를 다룰 수 있다.

---

class: center, middle, title-slide

## 데이터를 다루는 주요 7가지 동작

---

![](https://raw.githubusercontent.com/mrchypark/dabrp_classnote3/master/img/dplyr.png) 

---

## 실습 데이터 소개

[nycflights13](https://cran.r-project.org/web/packages/nycflights13/nycflights13.pdf)는 2013년 미국의 비행기 운항기록에 관련된 airlines, airports, flights, planes, weather의 5개 데이터를 가지고 있는 데이터 패키지


```r
if (!requireNamespace("nycflights13")) install.packages("nycflights13")
library(nycflights13)
nycflights13::flights
```

```
## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

## [nycflights13 코드북](https://cran.r-project.org/web/packages/nycflights13/nycflights13.pdf)


```r
str(flights)
```

```
## Classes 'tbl_df', 'tbl' and 'data.frame':	336776 obs. of  19 variables:
##  $ year          : int  2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...
##  $ month         : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ day           : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ dep_time      : int  517 533 542 544 554 554 555 557 557 558 ...
##  $ sched_dep_time: int  515 529 540 545 600 558 600 600 600 600 ...
##  $ dep_delay     : num  2 4 2 -1 -6 -4 -5 -3 -3 -2 ...
##  $ arr_time      : int  830 850 923 1004 812 740 913 709 838 753 ...
##  $ sched_arr_time: int  819 830 850 1022 837 728 854 723 846 745 ...
##  $ arr_delay     : num  11 20 33 -18 -25 12 19 -14 -8 8 ...
##  $ carrier       : chr  "UA" "UA" "AA" "B6" ...
##  $ flight        : int  1545 1714 1141 725 461 1696 507 5708 79 301 ...
##  $ tailnum       : chr  "N14228" "N24211" "N619AA" "N804JB" ...
##  $ origin        : chr  "EWR" "LGA" "JFK" "JFK" ...
##  $ dest          : chr  "IAH" "IAH" "MIA" "BQN" ...
##  $ air_time      : num  227 227 160 183 116 150 158 53 140 138 ...
##  $ distance      : num  1400 1416 1089 1576 762 ...
##  $ hour          : num  5 5 5 5 6 5 6 6 6 6 ...
##  $ minute        : num  15 29 40 45 0 58 0 0 0 0 ...
##  $ time_hour     : POSIXct, format: "2013-01-01 05:00:00" "2013-01-01 05:00:00" ...
```

---

class: center, middle, title-slide

[![](https://github.com/tidyverse/dplyr/raw/master/man/figures/logo.png)][3]

---

## 데이터를 다루는 주요 7가지 동작

.pull-left[
[dplyr][3]은 데이터를 다루는 주요 7가지 동작 자체를 함수로 가지고 추가적인 helper 함수를 함께 제공

1. 열 방향: 선택 - select()
1. 열 방향: 계산 - mutate()
1. 행 방향: 조건 - filter()
1. 행 방향: 추가 - bind_rows()
1. 행 방향: 정렬 - arrange()
1. 그룹 계산 - group_by() + summarise()
1. 열 결합 - left_join()
]
.pull-right[
![](https://raw.githubusercontent.com/mrchypark/dabrp_classnote3/master/img/dplyr.png) 
]

---

## dplyr 준비


```r
if (!requireNamespace("dplyr")) install.packages("dplyr")
```

```
## Loading required namespace: dplyr
```

```r
library(dplyr)
```

```
## 
## Attaching package: 'dplyr'
```

```
## The following objects are masked from 'package:stats':
## 
##     filter, lag
```

```
## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
```

---

### 열 방향: 선택 - select()

데이터에서 컬럼을 선택하여 사용함. select()는 선언된 순서대로 컬럼을 정렬함
.pull-left[
```{}
select(flights, year, month, day)
```
]
.pull-right[

```
## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows
```
]
---

### 열 방향: 선택 - select()

숫자에서만 제공하던 from:to 문법을 컬럼 순서를 기준으로 지원
.pull-left[
```{}
select(flights, year:day)
```
]
.pull-right[

```
## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows
```
]
---

### 열 방향: 선택 - select()

-(마이너스)는 지정한 컬럼을 제외하고 전부라는 의미

```r
select(flights, -(year:day))
```

```
## # A tibble: 336,776 x 16
##    dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
##  1      517            515         2      830            819        11
##  2      533            529         4      850            830        20
##  3      542            540         2      923            850        33
##  4      544            545        -1     1004           1022       -18
##  5      554            600        -6      812            837       -25
##  6      554            558        -4      740            728        12
##  7      555            600        -5      913            854        19
##  8      557            600        -3      709            723       -14
##  9      557            600        -3      838            846        -8
## 10      558            600        -2      753            745         8
## # ... with 336,766 more rows, and 10 more variables: carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

### 열 방향: 선택 - select()

everything() 같은 helper 함수를 제공 everything()은 select()내에 선언된 컬럼을 제외한 나머지 전부라는 의미. 


```r
select(flights, time_hour, air_time, everything())
```

```
## # A tibble: 336,776 x 19
##              time_hour air_time  year month   day dep_time sched_dep_time
##                 &lt;dttm&gt;    &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
##  1 2013-01-01 05:00:00      227  2013     1     1      517            515
##  2 2013-01-01 05:00:00      227  2013     1     1      533            529
##  3 2013-01-01 05:00:00      160  2013     1     1      542            540
##  4 2013-01-01 05:00:00      183  2013     1     1      544            545
##  5 2013-01-01 06:00:00      116  2013     1     1      554            600
##  6 2013-01-01 05:00:00      150  2013     1     1      554            558
##  7 2013-01-01 06:00:00      158  2013     1     1      555            600
##  8 2013-01-01 06:00:00       53  2013     1     1      557            600
##  9 2013-01-01 06:00:00      140  2013     1     1      557            600
## 10 2013-01-01 06:00:00      138  2013     1     1      558            600
## # ... with 336,766 more rows, and 12 more variables: dep_delay &lt;dbl&gt;,
## #   arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;
```

---

### 열 방향: 선택 - select()

ends_with()같이 글자의 일부에 해당하는 컬럼 전부를 가져오는 helper 함수도 있음. 정규표현식의 주요 기능을 함수로 제공. ?select로 확인


```r
select(flights, year:day, ends_with("delay"), distance, air_time)
```

```
## # A tibble: 336,776 x 7
##     year month   day dep_delay arr_delay distance air_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1  2013     1     1         2        11     1400      227
##  2  2013     1     1         4        20     1416      227
##  3  2013     1     1         2        33     1089      160
##  4  2013     1     1        -1       -18     1576      183
##  5  2013     1     1        -6       -25      762      116
##  6  2013     1     1        -4        12      719      150
##  7  2013     1     1        -5        19     1065      158
##  8  2013     1     1        -3       -14      229       53
##  9  2013     1     1        -3        -8      944      140
## 10  2013     1     1        -2         8      733      138
## # ... with 336,766 more rows
```

---

### 열 방향: 계산 - mutate()

출력 편의를 위해 일부 데이터만 사용


```r
flights_sml &lt;- select(flights, year:day, ends_with("delay"), distance, air_time)
flights_sml
```

```
## # A tibble: 336,776 x 7
##     year month   day dep_delay arr_delay distance air_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1  2013     1     1         2        11     1400      227
##  2  2013     1     1         4        20     1416      227
##  3  2013     1     1         2        33     1089      160
##  4  2013     1     1        -1       -18     1576      183
##  5  2013     1     1        -6       -25      762      116
##  6  2013     1     1        -4        12      719      150
##  7  2013     1     1        -5        19     1065      158
##  8  2013     1     1        -3       -14      229       53
##  9  2013     1     1        -3        -8      944      140
## 10  2013     1     1        -2         8      733      138
## # ... with 336,766 more rows
```

---

### 열 방향: 계산 - mutate()

각 컬럼간의 계산으로 새로운 열을 만들 수 있음


```r
mutate(flights_sml,
       gain = arr_delay - dep_delay,
       speed = distance / air_time * 60
)
```

```
## # A tibble: 336,776 x 9
##     year month   day dep_delay arr_delay distance air_time  gain    speed
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
##  1  2013     1     1         2        11     1400      227     9 370.0441
##  2  2013     1     1         4        20     1416      227    16 374.2731
##  3  2013     1     1         2        33     1089      160    31 408.3750
##  4  2013     1     1        -1       -18     1576      183   -17 516.7213
##  5  2013     1     1        -6       -25      762      116   -19 394.1379
##  6  2013     1     1        -4        12      719      150    16 287.6000
##  7  2013     1     1        -5        19     1065      158    24 404.4304
##  8  2013     1     1        -3       -14      229       53   -11 259.2453
##  9  2013     1     1        -3        -8      944      140    -5 404.5714
## 10  2013     1     1        -2         8      733      138    10 318.6957
## # ... with 336,766 more rows
```


---

### 열 방향: 계산 - mutate()

컬럼을 지우거나 기존의 컬럼을 변경하는 것도 가능


```r
mutate(flights_sml,
       arr_delay = NULL,
       air_time = air_time / 60
)
```

```
## # A tibble: 336,776 x 6
##     year month   day dep_delay distance  air_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1  2013     1     1         2     1400 3.7833333
##  2  2013     1     1         4     1416 3.7833333
##  3  2013     1     1         2     1089 2.6666667
##  4  2013     1     1        -1     1576 3.0500000
##  5  2013     1     1        -6      762 1.9333333
##  6  2013     1     1        -4      719 2.5000000
##  7  2013     1     1        -5     1065 2.6333333
##  8  2013     1     1        -3      229 0.8833333
##  9  2013     1     1        -3      944 2.3333333
## 10  2013     1     1        -2      733 2.3000000
## # ... with 336,766 more rows
```


---

### 열 방향: 계산 - mutate()

transmute()는 계산한 컬럼만 있는 테이블을 생성


```r
transmute(flights,
          gain = arr_delay - dep_delay,
          hours = air_time / 60,
          gain_per_hour = gain / hours
)
```

```
## # A tibble: 336,776 x 3
##     gain     hours gain_per_hour
##    &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
##  1     9 3.7833333      2.378855
##  2    16 3.7833333      4.229075
##  3    31 2.6666667     11.625000
##  4   -17 3.0500000     -5.573770
##  5   -19 1.9333333     -9.827586
##  6    16 2.5000000      6.400000
##  7    24 2.6333333      9.113924
##  8   -11 0.8833333    -12.452830
##  9    -5 2.3333333     -2.142857
## 10    10 2.3000000      4.347826
## # ... with 336,766 more rows
```


---

### 열 방향: 계산 - mutate()

group_by()와 함께 [window function](http://dplyr.tidyverse.org/articles/window-functions.html) 들이 유용하게 사용됨


```r
flights_smlg &lt;- group_by(flights_sml, month)
mutate(flights_smlg, rank = row_number(desc(arr_delay)))
```

```
## # A tibble: 336,776 x 8
## # Groups:   month [12]
##     year month   day dep_delay arr_delay distance air_time  rank
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
##  1  2013     1     1         2        11     1400      227  6970
##  2  2013     1     1         4        20     1416      227  5064
##  3  2013     1     1         2        33     1089      160  3458
##  4  2013     1     1        -1       -18     1576      183 21131
##  5  2013     1     1        -6       -25      762      116 23925
##  6  2013     1     1        -4        12      719      150  6699
##  7  2013     1     1        -5        19     1065      158  5226
##  8  2013     1     1        -3       -14      229       53 19019
##  9  2013     1     1        -3        -8      944      140 15534
## 10  2013     1     1        -2         8      733      138  7912
## # ... with 336,766 more rows
```

---

### 행 방향: 조건 - filter()

filter()는 데이터 중에 조건에 해당하는 일부 데이터만 필터해서 사용. 논리 연산자와 결합하여 많이 사용하며 [이곳](https://mrchypark.github.io/r/operator/%EB%85%BC%EB%A6%AC-%EC%97%B0%EC%82%B0%EC%9E%90-%EC%A0%95%EB%A6%AC.html)에서 추가적으로 내용을 확인할 수 있음


```r
filter(flights, month == 1)
```

```
## # A tibble: 27,004 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 26,994 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

### 행 방향: 조건 - filter()

&amp; 는 **and** 라는 뜻이며 조건을 추가할 때 사용


```r
filter(flights, month == 1 &amp; day == 1)
```

```
## # A tibble: 842 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 832 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

### 행 방향: 조건 - filter()

| 는 **or** 라는 뜻


```r
filter(flights, month == 11 | month == 12)
```

```
## # A tibble: 55,403 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013    11     1        5           2359         6      352
##  2  2013    11     1       35           2250       105      123
##  3  2013    11     1      455            500        -5      641
##  4  2013    11     1      539            545        -6      856
##  5  2013    11     1      542            545        -3      831
##  6  2013    11     1      549            600       -11      912
##  7  2013    11     1      550            600       -10      705
##  8  2013    11     1      554            600        -6      659
##  9  2013    11     1      554            600        -6      826
## 10  2013    11     1      554            600        -6      749
## # ... with 55,393 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

### 행 방향: 조건 - filter()

**%in%**는 유용하게 사용하는 논리 연산자로 왼쪽에 있는 벡터가 오른쪽 벡터의 데이터 중 어느 하나라도 맞으면 출력


```r
filter(flights, month %in% c(11, 12))
```

```
## # A tibble: 55,403 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013    11     1        5           2359         6      352
##  2  2013    11     1       35           2250       105      123
##  3  2013    11     1      455            500        -5      641
##  4  2013    11     1      539            545        -6      856
##  5  2013    11     1      542            545        -3      831
##  6  2013    11     1      549            600       -11      912
##  7  2013    11     1      550            600       -10      705
##  8  2013    11     1      554            600        -6      659
##  9  2013    11     1      554            600        -6      826
## 10  2013    11     1      554            600        -6      749
## # ... with 55,393 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

### 행 방향: 조건 - filter()

! 는 local 데이터에서 결과를 반대로 뒤집는 역할을 하며 수학에서의 괄호와 같이 연산의 범위를 작성해 두는 것이 문제 발생 소지가 적어점


```r
filter(flights, !(arr_delay &gt; 120 | dep_delay &gt; 120))
```

```
## # A tibble: 316,050 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 316,040 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

### 행 방향: 추가 - bind_rows()

bind_rows()를 진행하기 위해서 데이터를 작성


```r
feb&lt;-filter(flights, month==2)
dec&lt;-filter(flights, month==12)
dim(feb); dim(dec)
```

```
## [1] 24951    19
```

```
## [1] 28135    19
```

```r
nrow(feb)+nrow(dec)
```

```
## [1] 53086
```

---

### 행 방향: 추가 - bind_rows()

bind_rows()는 컬럼 이름을 기준으로 같은 컬럼 밑에 데이터를 붙여서 **묶어줌**. 


```r
bind_rows(feb, dec)
```

```
## # A tibble: 53,086 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     2     1      456            500        -4      652
##  2  2013     2     1      520            525        -5      816
##  3  2013     2     1      527            530        -3      837
##  4  2013     2     1      532            540        -8     1007
##  5  2013     2     1      540            540         0      859
##  6  2013     2     1      552            600        -8      714
##  7  2013     2     1      552            600        -8      919
##  8  2013     2     1      552            600        -8      655
##  9  2013     2     1      553            600        -7      833
## 10  2013     2     1      553            600        -7      821
## # ... with 53,076 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

### 행 방향: 추가 - bind_rows()

list()로 구분된 데이터도 **묶어줌**.


```r
bind_rows(list(feb, dec))
```

```
## # A tibble: 53,086 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     2     1      456            500        -4      652
##  2  2013     2     1      520            525        -5      816
##  3  2013     2     1      527            530        -3      837
##  4  2013     2     1      532            540        -8     1007
##  5  2013     2     1      540            540         0      859
##  6  2013     2     1      552            600        -8      714
##  7  2013     2     1      552            600        -8      919
##  8  2013     2     1      552            600        -8      655
##  9  2013     2     1      553            600        -7      833
## 10  2013     2     1      553            600        -7      821
## # ... with 53,076 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

### 행 방향: 추가 - bind_rows()

split()은 첫번째 인자로 받은 데이터를 컬럼을 기준으로 list()로 분리해 줌. 


```r
flights_mon&lt;-split(flights, flights$month)
summary(flights_mon)
```

```
##    Length Class  Mode
## 1  19     tbl_df list
## 2  19     tbl_df list
## 3  19     tbl_df list
## 4  19     tbl_df list
## 5  19     tbl_df list
## 6  19     tbl_df list
## 7  19     tbl_df list
## 8  19     tbl_df list
## 9  19     tbl_df list
## 10 19     tbl_df list
## 11 19     tbl_df list
## 12 19     tbl_df list
```

---

### 행 방향: 추가 - bind_rows()

split()으로 분리된 12개의 list() 자료도 잘 합쳐줌


```r
nrow(flights)
```

```
## [1] 336776
```

```r
bind_rows(flights_mon)
```

```
## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

### 행 방향: 추가 - bind_rows()

다른 종류의 데이터도 **묶어줌**. c()는 vector를 생성하고, data_frame은 data.frame을 생성함


```r
bind_rows(
  c(a = 1, b = 2),
  data_frame(a = 3:4, b = 5:6),
  c(a = 7, b = 8)
)
```

```
## # A tibble: 4 x 2
##       a     b
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2
## 2     3     5
## 3     4     6
## 4     7     8
```

---

### 행 방향: 추가 - bind_rows()

데이터를 묶을 때 데이터를 구분하는 컬럼을 추가할 수 있음


```r
bind_rows(list(feb, dec), .id = "id")
```

```
## # A tibble: 53,086 x 20
##       id  year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1     1  2013     2     1      456            500        -4      652
##  2     1  2013     2     1      520            525        -5      816
##  3     1  2013     2     1      527            530        -3      837
##  4     1  2013     2     1      532            540        -8     1007
##  5     1  2013     2     1      540            540         0      859
##  6     1  2013     2     1      552            600        -8      714
##  7     1  2013     2     1      552            600        -8      919
##  8     1  2013     2     1      552            600        -8      655
##  9     1  2013     2     1      553            600        -7      833
## 10     1  2013     2     1      553            600        -7      821
## # ... with 53,076 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

### 행 방향: 추가 - bind_rows()

데이터를 구분하는 컬럼에 대해 이름이 동작하는 방식


```r
bind_rows(list(a = feb, b = dec), .id = "data")
```

```
## # A tibble: 53,086 x 20
##     data  year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1     a  2013     2     1      456            500        -4      652
##  2     a  2013     2     1      520            525        -5      816
##  3     a  2013     2     1      527            530        -3      837
##  4     a  2013     2     1      532            540        -8     1007
##  5     a  2013     2     1      540            540         0      859
##  6     a  2013     2     1      552            600        -8      714
##  7     a  2013     2     1      552            600        -8      919
##  8     a  2013     2     1      552            600        -8      655
##  9     a  2013     2     1      553            600        -7      833
## 10     a  2013     2     1      553            600        -7      821
## # ... with 53,076 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

### 행 방향: 추가 - bind_rows()

같은 이름의 컬럼이 없을 때는 NA로 채우면서 동작함


```r
bind_rows(data.frame(x = 1:3), data.frame(y = 1:4))
```

```
##    x  y
## 1  1 NA
## 2  2 NA
## 3  3 NA
## 4 NA  1
## 5 NA  2
## 6 NA  3
## 7 NA  4
```

---

### 행 방향: 정렬 - arrange()

arrange()는 지정되는 컬럼 순으로 오름차순 정렬해주는 함수


```r
arrange(flights, dep_delay)
```

```
## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013    12     7     2040           2123       -43       40
##  2  2013     2     3     2022           2055       -33     2240
##  3  2013    11    10     1408           1440       -32     1549
##  4  2013     1    11     1900           1930       -30     2233
##  5  2013     1    29     1703           1730       -27     1947
##  6  2013     8     9      729            755       -26     1002
##  7  2013    10    23     1907           1932       -25     2143
##  8  2013     3    30     2030           2055       -25     2213
##  9  2013     3     2     1431           1455       -24     1601
## 10  2013     5     5      934            958       -24     1225
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

### 행 방향: 정렬 - arrange()

desc()는 내림차순 정렬로 방향을 바꾸는 helper 함수


```r
arrange(flights, desc(month), dep_delay)
```

```
## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013    12     7     2040           2123       -43       40
##  2  2013    12    25     2036           2059       -23     2313
##  3  2013    12     4     1910           1930       -20     2101
##  4  2013    12    11      710            730       -20     1039
##  5  2013    12    10     1841           1900       -19     2028
##  6  2013    12    14      921            940       -19     1256
##  7  2013    12     6      811            829       -18     1119
##  8  2013    12    30      657            715       -18      927
##  9  2013    12     7     1658           1715       -17     1956
## 10  2013    12     7     2043           2100       -17     2250
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

### 그룹 계산 - group_by() + summarise()

summarise()는 여러 데이터를 요약하여 특성을 파악하는 방식으로 동작하는 함수들을 적용할 때 사용.


```r
summarise(flights, mean = mean(dep_delay, na.rm=T), n = n())
```

```
## # A tibble: 1 x 2
##       mean      n
##      &lt;dbl&gt;  &lt;int&gt;
## 1 12.63907 336776
```

---

### 그룹 계산 - group_by() + summarise()

group_by()는 데이터에 **지정한 컬럼별**이라는 추가 조건을 지정하는 기능을 수행


```r
flights_g&lt;-group_by(flights, month)
flights_g
```

```
## # A tibble: 336,776 x 19
## # Groups:   month [12]
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

```r
summarise(flights_g, mean = mean(dep_delay, na.rm=T), n = n())
```

```
## # A tibble: 12 x 3
##    month      mean     n
##    &lt;int&gt;     &lt;dbl&gt; &lt;int&gt;
##  1     1 10.036665 27004
##  2     2 10.816843 24951
##  3     3 13.227076 28834
##  4     4 13.938038 28330
##  5     5 12.986859 28796
##  6     6 20.846332 28243
##  7     7 21.727787 29425
##  8     8 12.611040 29327
##  9     9  6.722476 27574
## 10    10  6.243988 28889
## 11    11  5.435362 27268
## 12    12 16.576688 28135
```

---

### 그룹 계산 - group_by() + summarise()

group_by()에 의해 **지정한 컬럼별** summarise()연산을 수행함


```r
summarise(flights_g, mean = mean(dep_delay, na.rm=T), n = n())
```

```
## # A tibble: 12 x 3
##    month      mean     n
##    &lt;int&gt;     &lt;dbl&gt; &lt;int&gt;
##  1     1 10.036665 27004
##  2     2 10.816843 24951
##  3     3 13.227076 28834
##  4     4 13.938038 28330
##  5     5 12.986859 28796
##  6     6 20.846332 28243
##  7     7 21.727787 29425
##  8     8 12.611040 29327
##  9     9  6.722476 27574
## 10    10  6.243988 28889
## 11    11  5.435362 27268
## 12    12 16.576688 28135
```
---

### 열 결합(Join) - left_join()

select()를 사용하여 데이터 준비


```r
flights2 &lt;- select(flights, year:day, hour, origin, dest, tailnum, carrier)
flights2
```

```
## # A tibble: 336,776 x 8
##     year month   day  hour origin  dest tailnum carrier
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;
##  1  2013     1     1     5    EWR   IAH  N14228      UA
##  2  2013     1     1     5    LGA   IAH  N24211      UA
##  3  2013     1     1     5    JFK   MIA  N619AA      AA
##  4  2013     1     1     5    JFK   BQN  N804JB      B6
##  5  2013     1     1     6    LGA   ATL  N668DN      DL
##  6  2013     1     1     5    EWR   ORD  N39463      UA
##  7  2013     1     1     6    EWR   FLL  N516JB      B6
##  8  2013     1     1     6    LGA   IAD  N829AS      EV
##  9  2013     1     1     6    JFK   MCO  N593JB      B6
## 10  2013     1     1     6    LGA   ORD  N3ALAA      AA
## # ... with 336,766 more rows
```
---

### 열 결합(Join) - left_join()

left_join()은 왼쪽 데이터를 기준으로 하고, by로 지정된 컬럼이 같은 데이터임을 식별하는 key로 지정하여 오른쪽 데이터를 왼쪽 데이터에 결합하는 함수


```r
left_join(flights2, airlines, by = "carrier")
```

```
## # A tibble: 336,776 x 9
##     year month   day  hour origin  dest tailnum carrier
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;
##  1  2013     1     1     5    EWR   IAH  N14228      UA
##  2  2013     1     1     5    LGA   IAH  N24211      UA
##  3  2013     1     1     5    JFK   MIA  N619AA      AA
##  4  2013     1     1     5    JFK   BQN  N804JB      B6
##  5  2013     1     1     6    LGA   ATL  N668DN      DL
##  6  2013     1     1     5    EWR   ORD  N39463      UA
##  7  2013     1     1     6    EWR   FLL  N516JB      B6
##  8  2013     1     1     6    LGA   IAD  N829AS      EV
##  9  2013     1     1     6    JFK   MCO  N593JB      B6
## 10  2013     1     1     6    LGA   ORD  N3ALAA      AA
## # ... with 336,766 more rows, and 1 more variables: name &lt;chr&gt;
```
---

### 열 결합(Join) - left_join()

mutate(), match()등의 함수로 구현하려면 아래와 같음


```r
mutate(flights2, name = airlines$name[match(carrier, airlines$carrier)])
```

```
## # A tibble: 336,776 x 9
##     year month   day  hour origin  dest tailnum carrier
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;
##  1  2013     1     1     5    EWR   IAH  N14228      UA
##  2  2013     1     1     5    LGA   IAH  N24211      UA
##  3  2013     1     1     5    JFK   MIA  N619AA      AA
##  4  2013     1     1     5    JFK   BQN  N804JB      B6
##  5  2013     1     1     6    LGA   ATL  N668DN      DL
##  6  2013     1     1     5    EWR   ORD  N39463      UA
##  7  2013     1     1     6    EWR   FLL  N516JB      B6
##  8  2013     1     1     6    LGA   IAD  N829AS      EV
##  9  2013     1     1     6    JFK   MCO  N593JB      B6
## 10  2013     1     1     6    LGA   ORD  N3ALAA      AA
## # ... with 336,766 more rows, and 1 more variables: name &lt;chr&gt;
```
---

### 열 결합(Join) - left_join()

key 역할을 할 컬럼을 지정하지 않으면 양쪽 데이터에서 컬럼 이름이 같은 모든 컬럼을 key로 자동 지정


```r
left_join(flights2, weather)
```

```
## Joining, by = c("year", "month", "day", "hour", "origin")
```

```
## # A tibble: 336,776 x 18
##     year month   day  hour origin  dest tailnum carrier  temp  dewp humid
##    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1     5    EWR   IAH  N14228      UA    NA    NA    NA
##  2  2013     1     1     5    LGA   IAH  N24211      UA    NA    NA    NA
##  3  2013     1     1     5    JFK   MIA  N619AA      AA    NA    NA    NA
##  4  2013     1     1     5    JFK   BQN  N804JB      B6    NA    NA    NA
##  5  2013     1     1     6    LGA   ATL  N668DN      DL 39.92 26.06 57.33
##  6  2013     1     1     5    EWR   ORD  N39463      UA    NA    NA    NA
##  7  2013     1     1     6    EWR   FLL  N516JB      B6 39.02 26.06 59.37
##  8  2013     1     1     6    LGA   IAD  N829AS      EV 39.92 26.06 57.33
##  9  2013     1     1     6    JFK   MCO  N593JB      B6 39.02 26.06 59.37
## 10  2013     1     1     6    LGA   ORD  N3ALAA      AA 39.92 26.06 57.33
## # ... with 336,766 more rows, and 7 more variables: wind_dir &lt;dbl&gt;,
## #   wind_speed &lt;dbl&gt;, wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;, pressure &lt;dbl&gt;,
## #   visib &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
---

### 열 결합(Join) - left_join()

여러 컬럼이 key로써 가능할 때 명시적인 지정이 있으면 작성된 컬럼만 key로 동작


```r
left_join(flights2, planes, by = "tailnum")
```

```
## # A tibble: 336,776 x 16
##    year.x month   day  hour origin  dest tailnum carrier year.y
##     &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;int&gt;
##  1   2013     1     1     5    EWR   IAH  N14228      UA   1999
##  2   2013     1     1     5    LGA   IAH  N24211      UA   1998
##  3   2013     1     1     5    JFK   MIA  N619AA      AA   1990
##  4   2013     1     1     5    JFK   BQN  N804JB      B6   2012
##  5   2013     1     1     6    LGA   ATL  N668DN      DL   1991
##  6   2013     1     1     5    EWR   ORD  N39463      UA   2012
##  7   2013     1     1     6    EWR   FLL  N516JB      B6   2000
##  8   2013     1     1     6    LGA   IAD  N829AS      EV   1998
##  9   2013     1     1     6    JFK   MCO  N593JB      B6   2004
## 10   2013     1     1     6    LGA   ORD  N3ALAA      AA     NA
## # ... with 336,766 more rows, and 7 more variables: type &lt;chr&gt;,
## #   manufacturer &lt;chr&gt;, model &lt;chr&gt;, engines &lt;int&gt;, seats &lt;int&gt;,
## #   speed &lt;int&gt;, engine &lt;chr&gt;
```
---

### 열 결합(Join) - left_join()

여러 컬럼이 key로 동작했을 때 데이터가 잘못 되는 예


```r
left_join(flights2, planes)
```

```
## Joining, by = c("year", "tailnum")
```

```
## # A tibble: 336,776 x 15
##     year month   day  hour origin  dest tailnum carrier  type manufacturer
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;
##  1  2013     1     1     5    EWR   IAH  N14228      UA  &lt;NA&gt;         &lt;NA&gt;
##  2  2013     1     1     5    LGA   IAH  N24211      UA  &lt;NA&gt;         &lt;NA&gt;
##  3  2013     1     1     5    JFK   MIA  N619AA      AA  &lt;NA&gt;         &lt;NA&gt;
##  4  2013     1     1     5    JFK   BQN  N804JB      B6  &lt;NA&gt;         &lt;NA&gt;
##  5  2013     1     1     6    LGA   ATL  N668DN      DL  &lt;NA&gt;         &lt;NA&gt;
##  6  2013     1     1     5    EWR   ORD  N39463      UA  &lt;NA&gt;         &lt;NA&gt;
##  7  2013     1     1     6    EWR   FLL  N516JB      B6  &lt;NA&gt;         &lt;NA&gt;
##  8  2013     1     1     6    LGA   IAD  N829AS      EV  &lt;NA&gt;         &lt;NA&gt;
##  9  2013     1     1     6    JFK   MCO  N593JB      B6  &lt;NA&gt;         &lt;NA&gt;
## 10  2013     1     1     6    LGA   ORD  N3ALAA      AA  &lt;NA&gt;         &lt;NA&gt;
## # ... with 336,766 more rows, and 5 more variables: model &lt;chr&gt;,
## #   engines &lt;int&gt;, seats &lt;int&gt;, speed &lt;int&gt;, engine &lt;chr&gt;
```
---

### 열 결합(Join) - left_join()

컬럼 이름이 다를 때는 아래와 같은 문법을 사용


```r
left_join(flights2, airports, c("dest" = "faa"))
```

```
## # A tibble: 336,776 x 15
##     year month   day  hour origin  dest tailnum carrier
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;
##  1  2013     1     1     5    EWR   IAH  N14228      UA
##  2  2013     1     1     5    LGA   IAH  N24211      UA
##  3  2013     1     1     5    JFK   MIA  N619AA      AA
##  4  2013     1     1     5    JFK   BQN  N804JB      B6
##  5  2013     1     1     6    LGA   ATL  N668DN      DL
##  6  2013     1     1     5    EWR   ORD  N39463      UA
##  7  2013     1     1     6    EWR   FLL  N516JB      B6
##  8  2013     1     1     6    LGA   IAD  N829AS      EV
##  9  2013     1     1     6    JFK   MCO  N593JB      B6
## 10  2013     1     1     6    LGA   ORD  N3ALAA      AA
## # ... with 336,766 more rows, and 7 more variables: name &lt;chr&gt;, lat &lt;dbl&gt;,
## #   lon &lt;dbl&gt;, alt &lt;int&gt;, tz &lt;dbl&gt;, dst &lt;chr&gt;, tzone &lt;chr&gt;
```
---

### 열 결합(Join) - left_join()

rename()을 이용해 맞추는 방법도 가능


```r
left_join(flights2, rename(airports, dest=faa), by="dest")
```

```
## # A tibble: 336,776 x 15
##     year month   day  hour origin  dest tailnum carrier
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;
##  1  2013     1     1     5    EWR   IAH  N14228      UA
##  2  2013     1     1     5    LGA   IAH  N24211      UA
##  3  2013     1     1     5    JFK   MIA  N619AA      AA
##  4  2013     1     1     5    JFK   BQN  N804JB      B6
##  5  2013     1     1     6    LGA   ATL  N668DN      DL
##  6  2013     1     1     5    EWR   ORD  N39463      UA
##  7  2013     1     1     6    EWR   FLL  N516JB      B6
##  8  2013     1     1     6    LGA   IAD  N829AS      EV
##  9  2013     1     1     6    JFK   MCO  N593JB      B6
## 10  2013     1     1     6    LGA   ORD  N3ALAA      AA
## # ... with 336,766 more rows, and 7 more variables: name &lt;chr&gt;, lat &lt;dbl&gt;,
## #   lon &lt;dbl&gt;, alt &lt;int&gt;, tz &lt;dbl&gt;, dst &lt;chr&gt;, tzone &lt;chr&gt;
```

---

class: center, middle, title-slide

## tidy data, long form과 wide form

---

class: center, middle, title-slide

# tidy data + universe 

[![](https://github.com/tidyverse/tidyverse/raw/master/man/figures/logo.png)][1]

---

## [tidyverse][1] 패키지는

.pull-left[
1. RStudio가 개발, 관리하는 패키지    
1. 공식 문서가 매우 잘 되어 있음    
1. 사용자층이 두터워 영어로 검색하면 많은 질답을 찾을 수 있음    
1. 커뮤니티 설명글도 매우 많음    
1. 6개의 핵심 패키지 포함 23가지 패키지로 이루어진 메타 패키지    
1. tidy data 라는 사상과 파이프 연산자로 대동단결    
1. 사상에 영감을 받아 맞춰서 제작하는 개인 패키지가 많음(ex&gt; [tidyquant](https://github.com/business-science/tidyquant), [tidytext](https://github.com/juliasilge/tidytext) 등)
]
.pull-right[

```r
if (!requireNamespace("tidyverse")){
  install.packages("tidyverse")}
```

```
## Loading required namespace: tidyverse
```

```r
library(tidyverse)
```

```
## Loading tidyverse: ggplot2
## Loading tidyverse: tibble
## Loading tidyverse: tidyr
## Loading tidyverse: readr
## Loading tidyverse: purrr
```

```
## Conflicts with tidy packages ----------------------------------------------
```

```
## filter(): dplyr, stats
## lag():    dplyr, stats
```
]
---

## tidy data 란

1. [Hadley Wickham](https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html)  2. [고감자님의 블로그](http://freesearch.pe.kr/archives/3942)  3. [헬로우데이터과학](http://www.hellodatascience.com/?p=287)


1.1 Each variable forms a column.    
1.2 각 변수는 개별의 열(column)으로 존재한다.    
1.3 각 열에는 개별 속성이 들어간다.    

2.1 Each observation forms a row.    
2.2 각 관측치는 행(row)를 구성한다.    
2.3 각 행에는 개별 관찰 항목이 들어간다.    

3.1 Each type of observational unit forms a table.    
3.2 각 테이블은 단 하나의 관측기준에 의해서 조직된 데이터를 저장한다.    
3.3 각 테이블에는 단일 유형의 데이터가 들어간다.    

.footnote[
  \* 출처 : [금융데이터 분석을 위한 R 입문][2]
]
---

## tidy data 란

![](http://garrettgman.github.io/images/tidy-1.png)

.footnote[
  \* 출처 : [Garrett Grolemund의 Data Science with R 블로그](http://garrettgman.github.io/tidying/)
]

---

## long form vs wide form

.pull-left[
### long form

1. 컴퓨터가 계산하기 좋은 모양
1. tidy data의 요건을 충족
1. tidyverse의 패키지 대부분의 입력 형태
]
.pull-right[
### wide form

1. 사람이 눈으로 보기 좋은 모양
1. 2개 변수에 대한 값만 확인 가능
1. dashboard 형이라고도 하며 조인 등 연산이 어려움
]

---

class: center, middle, title-slide

## 함수를 연결하는 파이프 연산자(%&gt;%)

![](https://raw.githubusercontent.com/mrchypark/dabrp_classnote3/master/img/pipes.png)

---

## 파이프 연산자(%&gt;%)

함수를 중첩해서 사용할 일이 점점 빈번해 짐

```{}
plot(diff(log(sample(rnorm(10000,mean=10,sd=1),size=100,replace=FALSE))),col="red",type="l")
```

--

### %&gt;%를 사용하면 

.pull-left[

1. 생각의 순서대로 함수를 작성할 수 있음
1. 중간 변수 저장을 할 필요가 없음
1. 순서가 읽이 용이하여 기억하기 좋음
]
.pull-right[
```{}
rnorm(10000,mean=10,sd=1) %&gt;%
  sample(size=100,replace=FALSE) %&gt;%
  log %&gt;%
  diff %&gt;%
  plot(col="red",type="l")
```
]
---

## 파이프 연산자(%&gt;%)

flights 데이터에 파이프 연산자 사용예 1


```r
flights %&gt;%
  group_by(year,month,day) %&gt;%
  summarise(delay=mean(dep_delay, na.rm = TRUE))
```

```
## # A tibble: 365 x 4
## # Groups:   year, month [?]
##     year month   day     delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;
##  1  2013     1     1 11.548926
##  2  2013     1     2 13.858824
##  3  2013     1     3 10.987832
##  4  2013     1     4  8.951595
##  5  2013     1     5  5.732218
##  6  2013     1     6  7.148014
##  7  2013     1     7  5.417204
##  8  2013     1     8  2.553073
##  9  2013     1     9  2.276477
## 10  2013     1    10  2.844995
## # ... with 355 more rows
```
---

## 파이프 연산자(%&gt;%)

group_by()는 filter()와도 함께 사용할 수 있음


```r
popular_dests &lt;- flights %&gt;% 
  group_by(dest) %&gt;% 
  filter(n() &gt; 365)
popular_dests
```

```
## # A tibble: 332,577 x 19
## # Groups:   dest [77]
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 332,567 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

## 파이프 연산자(%&gt;%)

사용할 데이터부터 순서대로 함수를 작성할 있는 장점


```r
popular_dests %&gt;% 
  filter(arr_delay &gt; 0) %&gt;% 
  mutate(prop_delay = arr_delay / sum(arr_delay)) %&gt;% 
  select(year:day, dest, arr_delay, prop_delay)
```

```
## # A tibble: 131,106 x 6
## # Groups:   dest [77]
##     year month   day  dest arr_delay   prop_delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1  2013     1     1   IAH        11 1.106740e-04
##  2  2013     1     1   IAH        20 2.012255e-04
##  3  2013     1     1   MIA        33 2.350026e-04
##  4  2013     1     1   ORD        12 4.239594e-05
##  5  2013     1     1   FLL        19 9.377853e-05
##  6  2013     1     1   ORD         8 2.826396e-05
##  7  2013     1     1   LAX         7 3.444441e-05
##  8  2013     1     1   DFW        31 2.817951e-04
##  9  2013     1     1   ATL        12 3.996017e-05
## 10  2013     1     1   DTW        16 1.157257e-04
## # ... with 131,096 more rows
```

---

class: center, middle, title-slide

[![](https://github.com/tidyverse/tidyr/raw/master/man/figures/logo.png)][4]

---

## tidyr이 데이터를 tidy하게 만드는 4개 함수

[tidyr][4]은 데이터를 tidy하게 만드는 4개 함수를 제공하고 추가적인 helper 함수를 함께 제공

1. gather()   : wide form 데이터를 long form 으로 변환
1. spread()   : long form 데이터를 wide form 으로 변환
1. separate() : 하나의 컬럼을 두 개로 나눔
1. unite()    : 두 개의 컬럼을 하나로 합침

---

## tidyr 준비

tidyr, dplyr은 tidyverse에 포함된 패키지이기 때문에 tidyverse를 설치하고 불러왔다면 생략가능


```r
if (!requireNamespace("tidyr")) install.packages("tidyr")
library(tidyr)
```

---

### 데이터 소개

tidyr 패키지는 패키지의 동작을 설명하기 위해 내장 데이터를 준비하고 있음


```r
table1
```

```
## # A tibble: 6 x 4
##       country  year  cases population
##         &lt;chr&gt; &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3      Brazil  1999  37737  172006362
## 4      Brazil  2000  80488  174504898
## 5       China  1999 212258 1272915272
## 6       China  2000 213766 1280428583
```
---

### 데이터 소개

long form 예시


```r
table2
```

```
## # A tibble: 12 x 4
##        country  year       type      count
##          &lt;chr&gt; &lt;int&gt;      &lt;chr&gt;      &lt;int&gt;
##  1 Afghanistan  1999      cases        745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000      cases       2666
##  4 Afghanistan  2000 population   20595360
##  5      Brazil  1999      cases      37737
##  6      Brazil  1999 population  172006362
##  7      Brazil  2000      cases      80488
##  8      Brazil  2000 population  174504898
##  9       China  1999      cases     212258
## 10       China  1999 population 1272915272
## 11       China  2000      cases     213766
## 12       China  2000 population 1280428583
```
---

### 데이터 소개

한 컬럼에 두 개의 의미를 지닌 데이터가 들어 있는 경우


```r
table3
```

```
## # A tibble: 6 x 3
##       country  year              rate
## *       &lt;chr&gt; &lt;int&gt;             &lt;chr&gt;
## 1 Afghanistan  1999      745/19987071
## 2 Afghanistan  2000     2666/20595360
## 3      Brazil  1999   37737/172006362
## 4      Brazil  2000   80488/174504898
## 5       China  1999 212258/1272915272
## 6       China  2000 213766/1280428583
```
---

### 데이터 소개

wide form 예시 1


```r
table4a
```

```
## # A tibble: 3 x 3
##       country `1999` `2000`
## *       &lt;chr&gt;  &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan    745   2666
## 2      Brazil  37737  80488
## 3       China 212258 213766
```
---

### 데이터 소개

wide form 예시 2


```r
table4b
```

```
## # A tibble: 3 x 3
##       country     `1999`     `2000`
## *       &lt;chr&gt;      &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan   19987071   20595360
## 2      Brazil  172006362  174504898
## 3       China 1272915272 1280428583
```
---

### wide to long - gather()

.pull-left[
```{}
# case of column name is value

table4a
table4a %&gt;% 
  gather(`1999`, `2000`, key = "year", value = "cases")

# case of value is column name
table2
spread(table2, key = type, value = count)

# separate columns
table3
table3 %&gt;% 
  separate(rate, into = c("cases", "population"))

# separate columns with class set
table3 %&gt;% 
  separate(rate, into = c("cases", "population"), convert = TRUE)

# separate int columns
table3 %&gt;% 
  separate(year, into = c("century", "year"), sep = 2)

# unite two columns to new column
table5 %&gt;% 
  unite(new, century, year)

# unite two columns to new column controll to sep characters
table5 %&gt;% 
  unite(new, century, year, sep = "")
```
]
.pull-right[

```
## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows
```
]

---

### long to wide - spread() 

데이터에서 컬럼을 선택하여 사용함. select()는 선언된 순서대로 컬럼을 정렬함
.pull-left[
```{}
select(flights, year, month, day)
```
]
.pull-right[

```
## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows
```
]

---

### 컬럼을 분리 - separate()

데이터에서 컬럼을 선택하여 사용함. select()는 선언된 순서대로 컬럼을 정렬함
.pull-left[
```{}
select(flights, year, month, day)
```
]
.pull-right[

```
## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows
```
]

---

### 컬럼을 합침 - unite()

데이터에서 컬럼을 선택하여 사용함. select()는 선언된 순서대로 컬럼을 정렬함
.pull-left[
```{}
select(flights, year, month, day)
```
]
.pull-right[

```
## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows
```
]

---

# sql

## CRUD

create: 데이터의 생성    
read  : 데이터의 조회    
update: 데이터의 변경    
delete: 데이터의 제거    

## 분석에 사용되는 READ

```
SELECT
FROM
(WHERE)
(GROUP BY)
(ORDER BY)
```

## select

select는 column을 선택하는 구문입니다. 기존에 있는 데이터를 기준으로 어떤 column을 선택할꺼냐를 묻는 곳으로 전체가 필요하면 *를 사용합니다.

## from

from은 table을 선택하는 구문입니다. 생각 같아서는 어디 테이블에 어디 컬럼이 좋을 것 같은데, 영문권에서는 이 순서가 더 자연스러운 모양입니다.

## where

where는 조건문입니다. 위에 두 경우(table, column)에 해당하는 데이터 전체를 가져오고 싶으면 select * from bank 같이 bank테이블 전체를 가져오는 query를 작성하시면 됩니다. 하지만 그 와중에 데이터들이 조건에 해당하는 일정 부분만 필요하면 그 부분을 where 뒤에 작성하시면 됩니다.

## group by

group by는 선택한 column으로 묶어서 처리하라는 뜻입니다. 예를 들어 A반의 학생들 평균을 알고 싶으면 A반 학생이라는 조건인 성적만 가져와서 평균을 낼 수도 있지만, 반끼리 데이터를 사용하라고 알려주고 평균을 구할 수도 있습니다.

## order by

order by는 정렬을 위한 column을 정할 때 사용합니다. db는 table의 데이터를 저장할 때 순서를 고려해서 저장하지 않습니다. 그렇기 때문에 사람의 편의를 위해 순서를 강제하는 방법을 알려주는 것입니다.

## as

하나 더 as는 길게 만들어진 무엇을 줄여서 쉽게 작성하기 위해서 사용합니다. column명이나 table명에서 많이 사용합니다.

## data.frame과 비교 1
```
# for R
train

# for db
select * from train
```

## data.frame과 비교 2
```
# for R
train[,c("date","age")]

# for db
select date, age from train
```


## data.frame과 비교 3
```
# for R
train[train$date &gt; 2016-06-28 ,c("date","age")]

# for db
select date, age from train where train.date &gt; 2016-07-28
```
## data.frame과 비교 4
```
# for R
data&lt;-train[,c("sex","age")]
mean(data[data$sex=="F","age"])
mean(data[data$sex=="M","age"])

# for db
select sex, avg(age) from train group by sex
```

## join

![](http://rapapa.net/wp/wp-content/uploads/2012/06/Visual_SQL_JOINS_V2.png)

## inner join

```
select *
from A inner join B on A.key = b.key;
```

## outer join

```
select *
from A outer join B on A.key = b.key;
```

## left join
```
select *
from A left join B on A.key = b.key;
```


## data.table

[cheat sheet](https://s3.amazonaws.com/assets.datacamp.com/img/blog/data+table+cheat+sheet.pdf)

## 과제

- recomen 폴더에 있는 6개 데이터를 활용해서 다음장의 6개 질문에 답해주세요.
- 데이터가 5개이신 분은 아래 코드를 실행해서 다운로드해주세요. 1.4G라 시간이 좀 걸립니다.    

```
chk&lt;-file.info("./recomen/tran.csv")
if(is.na(chk$size)){
  recoment&lt;-"http://rcoholic.duckdns.org/oc/index.php/s/jISrPutj4ocLci2/download"
  dir.create("./recomen", showWarnings = F)
  download.file(recoment,destfile="./recomen/tran.csv",mode='wb')
}

```    

- 답을 구하기 위한 코드와 답을 class3assignment 폴더에 class3_[이름].R로 제출해주세요.(답은 주석으로 작성)
- sql, dplyr+tidyr, data.table 등 무엇이든 사용하시고, 외부서비스도 가능하시면 무엇이든 사용하세요. 몇 문제는 계산 시간이 오래걸릴 수 있습니다.

## 문제

1. receiptNum가 "6998419"인 구매기록의 가격(amout)의 합은 얼마인가요?
2. 가장 비싼 item은 무엇인가요?
3. 사용자들이 가장 많이 사용한 체널은 mobile/app과 onlinemall 중에 무엇입니까?
4. 월매출이 2015년 03월 가장 높은 매장의 storeCode는 무엇인가요?
5. 경쟁사의 이용기록이 가장 많은 사용자의 성별은 무엇입니까?
  (competitor 데이터에서 1row가 1건이라고 가정)
6. 한번에 3개 이상 구매한 경우에 가장 많이 구매에 포함된 제품 카테고리(cate_3)는 무엇입니까?

---

# set packages

if (!require(devtools)) install.packages("devtools") 
if (!require(DBI)) devtools::install_github("rstats-db/DBI")
if (!require(RSQLite)) devtools::install_github("rstats-db/RSQLite")
if (!require(RMySQL)) devtools::install_github("rstats-db/RMySQL")
if (!require(bigrquery)) devtools::install_github("rstats-db/bigrquery")
if (!require(data.table)) install.packages("data.table")
if (!require(readr)) install.packages("readr")
if (!require(tidyverse)) install.packages("tidyverse")
if (!require(nycflights13)) install.packages("nycflights13")


# db set
library(DBI)
library(RSQLite)
library(RMySQL)
library(nycflights13)
con &lt;- dbConnect(SQLite(),
                 dbname="class3.sqlite")


con &lt;- DBI::dbConnect(SQLite(),
               dbname="class3.sqlite")

# write tables

dbWriteTable(con, "customer", fread("./recomen/customer.csv",encoding = "UTF-8"), overwrite=T)
dbWriteTable(con, "flights", flights, overwrite=T)
dbWriteTable(con, "airlines", airlines, overwrite=T)
dbWriteTable(con, "airports", airports, overwrite=T)
dbWriteTable(con, "planes", planes, overwrite=T)
dbWriteTable(con, "weather", weather, overwrite=T)

# check table list
dbListTables(con)

# select from 
dbGetQuery(con, "select * from planes
           limit 10")

# select from where
dbGetQuery(con, "select * from planes where year &gt; 2000")

# select columns
dbGetQuery(con, "select year, month, day from flights limit 10")

# group by
dbGetQuery(con, "select type, count(*) from planes group by type")
dbGetQuery(con, "select type, count(*) as SUM from planes group by type")

# order by 
dbGetQuery(con, "select type, count(*) from planes group by type order by count(*)")

# where
dbGetQuery(con, "select * from flights where month = 1")

# and
dbGetQuery(con, "select * from flights where month = 12 and day = 25")

# or
dbGetQuery(con, "select * from flights where arr_delay &gt; 120 or dep_delay &gt; 120")

# inner join
dbGetQuery(con, "select * from flights as a inner join planes as b on a.tailnum = b.tailnum")


flights %&gt;%
  group_by(year,month,day) %&gt;%
  summarise(delay=mean(dep_delay, na.rm = TRUE))





## dplyr with db
library(dplyr)
library(dbplyr)
library(RSQLite)

sqlite_db = src_sqlite('sqlite_db.sqlite', 
                       create = T)
                       
copy_to(sqlite_db, mtcars)

src_tbls(sqlite_db)
tbl(sqlite_db, 'mtcars')
tbl(sqlite_db, sql('SELECT * FROM mtcars'))

iris_db = tbl(sqlite_db, 'mtcars')
iris_db %&gt;% filter(mpg &gt; 20)

sql_db = src_mysql(dbname="bank",user = "root",password = "XXXX")
sql_db

src_bigquery


# data.table

library(data.table)

# get data

# url&lt;-"https://github.com/arunsrinivasan/flights/wiki/NYCflights14/flights14.csv"
# dir.create("./data",showWarnings = F)
# download.file(url,destfile = "./data/flights14.csv")

# read data
system.time(flights &lt;- read.csv("./data/flights14.csv"))  # to data.frame
system.time(flights &lt;- read_csv("./data/flights14.csv"))  # to tibble
system.time(flights &lt;- fread("./data/flights14.csv"))     # to data.table
flights
class(flights)
dim(flights)

# subset like where
ans &lt;- flights[origin == "JFK" &amp; month == 6L]
head(ans)

ans &lt;- flights[1:2]
ans

# order like order by
ans &lt;- flights[order(origin, -dest)]
head(ans)

# select column like select
ans &lt;- flights[, arr_delay]
head(ans)

# select columns like select
ans &lt;- flights[, .(arr_delay, dep_delay)]
head(ans)

# rename
ans &lt;- flights[, .(delay_arr = arr_delay, delay_dep = dep_delay)]
head(ans)

# transmute
flights[origin == "JFK" &amp; month == 6L,
        .(m_arr = mean(arr_delay), m_dep = mean(dep_delay))]



# length
flights[origin == "JFK" &amp; month == 6L, length(dest)]

# make count table 
flights[, .(.N), by = .(origin)]

# make count table with condition
flights[carrier == "AA", .N, by = origin]

# make count table with condition and group by
flights[carrier == "AA", .N, by = .(origin,dest)]

# add options
flights[carrier == "AA", .N, by = .(origin, dest)][order(origin, -dest)][1:10,]
## like pipe %&gt;%      [][][]....[]



[1]: https://www.tidyverse.org/
[2]: https://mrchypark.github.io/kisa_finR/#(5)
[3]: http://dplyr.tidyverse.org/
[4]: http://tidyr.tidyverse.org/
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {window.dispatchEvent(new Event('resize'));});
(function() {var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler"); if (!r) return; s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }"; d.head.appendChild(s);})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
